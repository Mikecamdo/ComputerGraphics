<!DOCTYPE html>

<html>
    <script id="vertex-shader" type="x-shader/x-vertex">
        #version 300 es

        in vec4 aPosition;

        in vec2 aTexCoord;
        out vec2 vTexCoord;

        void main()
        {
            vTexCoord = vec2(1.0 - aTexCoord.x, aTexCoord.y); // flips the orientation of the live video feed
            gl_Position = aPosition;
        }
    </script>

    <script id="fragment-shader-1" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            fColor = texture(uTexMap, vTexCoord);
        }
    </script>

    <script id="fragment-shader-2" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            vec3 w = vec3(0.2125, 0.7154, 0.0721);
            vec3 rgb = texture(uTexMap, vTexCoord).rgb;
            float lum = dot(rgb, w);
            fColor = vec4(lum, lum, lum, 1.0);
        }
    </script>

    <script id="fragment-shader-3" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            vec4 color = texture(uTexMap, vTexCoord);
            fColor = vec4(1.0 - color.r, 1.0 - color.g, 1.0 - color.b, 1.0);
        }
    </script>

    <script id="fragment-shader-4" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            vec3 w = vec3(0.2125, 0.7154, 0.0721);
            vec3 rgb = texture(uTexMap, vTexCoord).rgb;
            float t = 3.0;

            vec3 Q = (1.0 - t) * dot(rgb, w) + t * rgb;
            fColor = vec4(Q, 1.0);
        }
    </script>

    <script id="fragment-shader-5" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            // sepia filter, as described here: https://stackoverflow.com/questions/1061093/how-is-a-sepia-tone-created
            vec4 color = texture(uTexMap, vTexCoord);
            vec3 sepia = vec3(0.393 * color.r + 0.769 * color.g + 0.189 * color.b,
                              0.349 * color.r + 0.686 * color.g + 0.168 * color.b,
                              0.272 * color.r + 0.534 * color.g + 0.131 * color.b);

            fColor = vec4(sepia, 1.0);
        }
    </script>

    <script id="fragment-shader-6" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            // texelSize calculated off of image dimensions (640x360)
            vec2 texelSize = vec2(1.0/640.0, 1.0/360.0);        
            vec3 blur = vec3(0.0, 0.0, 0.0);

            // Applies a 15x15 kernel to blur the image
            for (int i = -7; i <= 7; i++) {
                for (int j = -7; j <= 7; j++) {
                    blur += texture(uTexMap, vTexCoord + vec2(i, j) * texelSize).rgb;
                }
            }

            blur /= 225.0; // normalizes the result

            fColor = vec4(blur, 1.0);
        }
    </script>

    <script id="fragment-shader-7" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            // takes the texture coordinate and distorts it
            vec2 newCoord = vTexCoord;
            newCoord.s = sin(newCoord.s);
            newCoord.t = 1.0 - cos(newCoord.t / 1.2) - 0.5;

            vec3 rgb = texture(uTexMap, newCoord).rgb;

            fColor = vec4(rgb, 1.0);
        }
    </script>

    <script id="fragment-shader-8" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            vec4 color = texture(uTexMap, vTexCoord);
            float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));
            float threshold = 0.5;

            if (gray > threshold) {
                fColor = vec4(1.0, 1.0, 1.0, 1.0);
            } else {
                fColor = vec4(0.0, 0.0, 0.0, 1.0);
            }
        }
    </script>

    <script id="fragment-shader-9" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            vec4 color = texture(uTexMap, vTexCoord);
            float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));

            float clusteredDotScreen[64] = float[](
                62.0, 57.0, 48.0, 36.0, 37.0, 49.0, 58.0, 63.0,
                56.0, 47.0, 35.0, 21.0, 22.0, 38.0, 50.0, 59.0,
                46.0, 34.0, 20.0, 10.0, 11.0, 23.0, 39.0, 51.0,
                33.0, 19.0, 9.0 , 3.0 , 0.0 , 4.0 , 12.0, 24.0,
                32.0, 18.0, 8.0 , 2.0 , 1.0 , 5.0 , 13.0, 25.0,
                45.0, 31.0, 17.0, 7.0 , 6.0 , 14.0, 26.0, 40.0,
                55.0, 44.0, 30.0, 16.0, 15.0, 27.0, 41.0, 52.0,
                61.0, 54.0, 43.0, 29.0, 28.0, 42.0, 53.0, 60.0
            );

            int col = int(mod(gl_FragCoord.x, 8.0));
            int row = int(mod(gl_FragCoord.y, 8.0));
            int index = row * 8 + col;

            float threshold = clusteredDotScreen[index];
            threshold /= 64.0;
 
            if (gray > threshold) {
                fColor = vec4(1.0, 1.0, 1.0, 1.0);
            } else {
                fColor = vec4(0.0, 0.0, 0.0, 1.0);
            }
        }
    </script>

    <script id="fragment-shader-10" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            vec4 color = texture(uTexMap, vTexCoord);
            float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));

            float bayerDotScreen[64] = float[](
                21.0, 37.0, 25.0, 41.0, 22.0, 38.0, 26.0, 42.0,
                53.0, 5.0 , 57.0, 9.0 , 54.0, 6.0 , 58.0, 10.0,
                29.0, 45.0, 17.0, 33.0, 30.0, 46.0, 18.0, 34.0,
                61.0, 13.0, 49.0, 1.0 , 62.0, 14.0, 50.0, 2.0 ,
                23.0, 39.0, 27.0, 43.0, 20.0, 36.0, 24.0, 40.0,
                55.0, 7.0 , 59.0, 11.0, 52.0, 4.0 , 56.0, 8.0 ,
                31.0, 47.0, 19.0, 35.0, 28.0, 44.0, 16.0, 32.0,
                63.0, 15.0, 51.0, 3.0 , 60.0, 12.0, 48.0, 0.0
            );

            int col = int(mod(gl_FragCoord.x, 8.0));
            int row = int(mod(gl_FragCoord.y, 8.0));
            int index = row * 8 + col;

            float threshold = bayerDotScreen[index];
            threshold /= 64.0;
 
            if (gray > threshold) {
                fColor = vec4(1.0, 1.0, 1.0, 1.0);
            } else {
                fColor = vec4(0.0, 0.0, 0.0, 1.0);
            }
        }
    </script>

    <script id="fragment-shader-11" type="x-shader/x-fragment">
        #version 300 es
        precision mediump float;

        in vec2 vTexCoord;
        out vec4 fColor;

        uniform sampler2D uTexMap;

        void main()
        {
            if (vTexCoord.x < 0.5) {
                fColor = texture(uTexMap, vec2(1.0 - vTexCoord.x, vTexCoord.y));
            } else {
                fColor = texture(uTexMap, vTexCoord);
            }
        }
    </script>

    <script type="text/javascript" src="../Common/initShaders.js"></script>
    <script type="text/javascript" src="CG_F23_Program3_DohertyMichael.js"></script>

    <body>
        <canvas id="gl-canvas" width="640" height="360">
        Oops ... your browser doesn't support the HTML5 canvas element
        </canvas>

        <video style="display: none;"></video>

        <br/>

        <label for="imageFilter">Choose Filter:</label>

        <select name="imageFilter" id="imageFilter">
            <option selected value="1">None</option>
            <option value="2">Grayscale</option>
            <option value="3">Image Negative</option>
            <option value="4">Saturated</option>
            <option value="5">Sepia</option>
            <option value="6">Blurry</option>
            <option value="7">Distortion</option>

            <option value="8">Constant Threshold Halftoning</option>
            <option value="9">Clustered Dot Screen</option>
            <option value="10">Bayer Dot Screen</option>

            <option value="11">Reflection</option>
        </select>
    </body>
</html>